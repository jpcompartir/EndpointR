% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/anthropic_messages.R
\name{ant_build_messages_request}
\alias{ant_build_messages_request}
\title{Build an Anthropic Messages API request}
\usage{
ant_build_messages_request(
  input,
  endpointr_id = NULL,
  model = .ANT_DEFAULT_MODEL,
  temperature = 0,
  max_tokens = 500L,
  schema = NULL,
  system_prompt = NULL,
  key_name = "ANTHROPIC_API_KEY",
  endpoint_url = .ANT_MESSAGES_ENDPOINT,
  timeout = 30L,
  max_retries = 5L
)
}
\arguments{
\item{input}{Text input to send to the model}

\item{endpointr_id}{An id that will persist through to response}

\item{model}{Anthropic model to use (default: "claude-haiku-4.5")}

\item{temperature}{Sampling temperature (0-2), higher values = more randomness}

\item{max_tokens}{Maximum tokens in response}

\item{schema}{Optional JSON schema for structured output (json_schema object or list)}

\item{system_prompt}{Optional system prompt}

\item{key_name}{Environment variable name for API key}

\item{endpoint_url}{Anthropic API endpoint URL}

\item{timeout}{Request timeout in seconds}

\item{max_retries}{Maximum number of retry attempts for failed requests}
}
\value{
An httr2 request object
}
\description{
Constructs an httr2 request object for Anthropic's Messages API.
Handles message formatting, system prompts, and optional JSON schema
for structured outputs.
}
\details{
This function creates the HTTP request but does not execute it. For
structured outputs, you must use a supported model (Claude Sonnet 4.5
or Opus 4.1) and the request will automatically include the required
beta header.

The \code{schema} parameter accepts either:
\itemize{
\item A \code{json_schema} S7 object created with \code{create_json_schema()}
\item A raw list in Anthropic's \code{output_format} structure
}

Unlike OpenAI, Anthropic uses \code{output_format} (not \code{response_format})
and the schema structure differs slightly.
}
\examples{
\dontrun{
  # simple request
  req <- ant_build_messages_request(
    input = "What is the capital of France?",
    max_tokens = 100
  )

  # with structured output
  schema <- create_json_schema(
    name = "capital_response",
    schema = schema_object(
      country = schema_string(),
      capital = schema_string(),
      required = c("country", "capital")
    )
  )
  req <- ant_build_messages_request(
    input = "What is the capital of France?",
    schema = schema,
    max_tokens = 100
  )
}
}
