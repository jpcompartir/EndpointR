<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Hugging Face Inference Endpoints • EndpointR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Hugging Face Inference Endpoints">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EndpointR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/api_keys.html">API Key Management</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Hugging Face</h6></li>
    <li><a class="dropdown-item" href="../articles/hugging_face_inference.html">Hugging Face Inference Endpoints</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>LLM Providers (OpenAI, Anthropic)</h6></li>
    <li><a class="dropdown-item" href="../articles/llm_providers.html">Working with Major LLM Providers</a></li>
    <li><a class="dropdown-item" href="../articles/structured_outputs_json_schema.html">Structured Outputs with JSON Schema</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/improving_performance.html">Improving Performance</a></li>
    <li><a class="dropdown-item" href="../articles/embeddings_providers.html">Embeddings Providers</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using Hugging Face Inference Endpoints</h1>
            
      

      <div class="d-none name"><code>hugging_face_inference.Rmd</code></div>
    </div>

    
    
<p>This vignette shows how to embed and classify text with EndpointR
using Hugging Face’s inference services.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jpcompartir.github.io/EndpointR/">EndpointR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>  text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Machine learning is fascinating"</span>,</span>
<span>    <span class="st">"I love working with embeddings"</span>, </span>
<span>    <span class="st">"Natural language processing is powerful"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ML"</span>, <span class="st">"embeddings"</span>, <span class="st">"NLP"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Follow Hugging Face’s <a href="https://huggingface.co/docs/hub/security-tokens" class="external-link">docs</a> to
generate a Hugging Face token, and then register it with EndpointR:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_api_key.html">set_api_key</a></span><span class="op">(</span><span class="st">"HF_TEST_API_KEY"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="choosing-your-service">Choosing Your Service<a class="anchor" aria-label="anchor" href="#choosing-your-service"></a>
</h2>
<p>Hugging Face offers two inference options:</p>
<ul>
<li>
<strong>Inference API</strong>: Free, good for testing</li>
<li>
<strong>Dedicated Endpoints</strong>: Paid, reliable, fast</li>
</ul>
<p>For this vignette, we’ll use the Inference API. To switch to
dedicated endpoints, just change the URL.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>Go to <a href="https://huggingface.co/models" class="external-link">Hugging Face’s models
hub</a> and fetch the Inference API’s URL for the model you want to
embed your data with. Not all models are available via the Hugging Face
Inference API, if you need to use a model that is not available you may
need to deploy a <a href="https://huggingface.co/inference-endpoints/dedicated" class="external-link">Dedicated
Inference Endpoint</a>.</p>
</div>
<div class="section level2">
<h2 id="embeddings">Embeddings<a class="anchor" aria-label="anchor" href="#embeddings"></a>
</h2>
<div class="section level3">
<h3 id="single-text">Single Text<a class="anchor" aria-label="anchor" href="#single-text"></a>
</h3>
<p>Embed one piece of text:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inference api url for embeddings</span></span>
<span><span class="va">embed_url</span> <span class="op">&lt;-</span> <span class="st">"https://router.huggingface.co/hf-inference/models/sentence-transformers/all-mpnet-base-v2/pipeline/feature-extraction"</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hf_embed_text.html">hf_embed_text</a></span><span class="op">(</span></span>
<span>  text <span class="op">=</span> <span class="st">"This is a sample text to embed"</span>,</span>
<span>  endpoint_url <span class="op">=</span> <span class="va">embed_url</span>,</span>
<span>  key_name <span class="op">=</span> <span class="st">"HF_API_KEY"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result is a tibble with one row and 384 columns (V1 to V384).
Each column is an embedding dimension.</p>
<blockquote>
<p><strong>Note</strong>: The number of columns depends on your model.
Check the model’s Hugging Face page for its embedding size.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="list-of-texts">List of Texts<a class="anchor" aria-label="anchor" href="#list-of-texts"></a>
</h3>
<p>Embed multiple texts at once using batching:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">texts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"First text to embed"</span>,</span>
<span>  <span class="st">"Second text to embed"</span>,</span>
<span>  <span class="st">"Third text to embed"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">batch_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hf_embed_batch.html">hf_embed_batch</a></span><span class="op">(</span></span>
<span>  <span class="va">texts</span>,</span>
<span>  endpoint_url <span class="op">=</span> <span class="va">embed_url</span>,</span>
<span>  key_name <span class="op">=</span> <span class="st">"HF_API_KEY"</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">3</span>  <span class="co"># process 3 texts per request</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result includes: - <code>text</code>: your original text -
<code>.error</code>: TRUE if something went wrong -
<code>.error_message</code>: what went wrong (if anything) -
<code>V1</code> to <code>V384</code>: the embedding values</p>
</div>
<div class="section level3">
<h3 id="data-frame">Data Frame<a class="anchor" aria-label="anchor" href="#data-frame"></a>
</h3>
<p>Most commonly, you’ll want to embed a column in a data frame:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">embedding_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hf_embed_df.html">hf_embed_df</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">my_data</span>,</span>
<span>  text_var <span class="op">=</span> <span class="va">text</span>,      <span class="co"># column with your text</span></span>
<span>  id_var <span class="op">=</span> <span class="va">id</span>,          <span class="co"># column with unique ids</span></span>
<span>  endpoint_url <span class="op">=</span> <span class="va">embed_url</span>,</span>
<span>  key_name <span class="op">=</span> <span class="st">"HF_API_KEY"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Check for errors:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">embedding_result</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">.error</span><span class="op">)</span></span></code></pre></div>
<p>Extract just the embeddings:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">embeddings_only</span> <span class="op">&lt;-</span> <span class="va">embedding_result</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">V1</span><span class="op">:</span><span class="va">V384</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a>
</h2>
<p>Classification works the same way as embeddings, just with a
different URL and output format. If neceessary, you can also provide a
custom function for tidying the output.</p>
<div class="section level3">
<h3 id="single-text-1">Single Text<a class="anchor" aria-label="anchor" href="#single-text-1"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classify_url</span> <span class="op">&lt;-</span> <span class="st">"https://router.huggingface.co/hf-inference/models/distilbert/distilbert-base-uncased-finetuned-sst-2-english"</span></span>
<span></span>
<span><span class="va">sentiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hf_classify_text.html">hf_classify_text</a></span><span class="op">(</span></span>
<span>  text <span class="op">=</span> <span class="st">"I love this package!"</span>,</span>
<span>  endpoint_url <span class="op">=</span> <span class="va">classify_url</span>,</span>
<span>  key_name <span class="op">=</span> <span class="st">"HF_API_KEY"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-frame-1">Data Frame<a class="anchor" aria-label="anchor" href="#data-frame-1"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classification_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hf_classify_df.html">hf_classify_df</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">my_data</span>,</span>
<span>  text_var <span class="op">=</span> <span class="va">text</span>,</span>
<span>  id_var <span class="op">=</span> <span class="va">id</span>,</span>
<span>  endpoint_url <span class="op">=</span> <span class="va">classify_url</span>,</span>
<span>  key_name <span class="op">=</span> <span class="st">"HF_API_KEY"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result includes: - Your original <code>id</code> column -
Classification labels (e.g., POSITIVE, NEGATIVE) - Confidence scores -
Error tracking columns.</p>
<blockquote>
<p><strong>NOTE</strong>: Classification labels are model specific.</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="using-dedicated-endpoints">Using Dedicated Endpoints<a class="anchor" aria-label="anchor" href="#using-dedicated-endpoints"></a>
</h2>
<p>To use dedicated endpoints instead of the Inference API:</p>
<ol style="list-style-type: decimal">
<li>Deploy your model to a dedicated endpoint (see Hugging Face
docs)</li>
<li>Get your endpoint URL</li>
<li>Replace the URL in any function:</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># just change this line</span></span>
<span><span class="va">dedicated_url</span> <span class="op">&lt;-</span> <span class="st">"https://your-endpoint-name.endpoints.huggingface.cloud"</span></span>
<span></span>
<span><span class="co"># everything else stays the same</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hf_embed_text.html">hf_embed_text</a></span><span class="op">(</span></span>
<span>  text <span class="op">=</span> <span class="st">"Sample text"</span>,</span>
<span>  endpoint_url <span class="op">=</span> <span class="va">dedicated_url</span>,  <span class="co"># &lt;- only change</span></span>
<span>  key_name <span class="op">=</span> <span class="st">"HF_API_KEY"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>Note</strong>: Dedicated endpoints take 20-30 seconds to
start if they’re idle. Set <code>max_retries = 5</code> to give them
time to wake up.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="tips">Tips<a class="anchor" aria-label="anchor" href="#tips"></a>
</h2>
<ul>
<li>Start with small batch sizes (3-5) and increase gradually</li>
<li>The Inference API has rate limits - dedicated endpoints have
hardware constraints, increase hardware for higher limits</li>
<li>For production use, choose dedicated endpoints</li>
<li>Check the <a href="articles/improving_performance.html">Improving
Performance</a> vignette for speed tips</li>
</ul>
</div>
<div class="section level2">
<h2 id="common-issues">Common Issues<a class="anchor" aria-label="anchor" href="#common-issues"></a>
</h2>
<p><strong>Rate limits</strong>: Reduce batch size or add delays between
requests</p>
<p><strong>Model not available</strong>: Not all models work with the
Inference API. Check the model page or use dedicated endpoints.</p>
<p><strong>Timeouts</strong>: Increase <code>max_retries</code> or
reduce batch size</p>
</div>
<div class="section level2">
<h2 id="improving-performance">Improving Performance<a class="anchor" aria-label="anchor" href="#improving-performance"></a>
</h2>
<p>EndpointR’s functions come with knobs and dials and you can turn to
improve throughput and performance. Visit the <a href="articles/improving_performance.html">Improving Performance</a>
vignette for more information.</p>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level3">
<h3 id="comparison-of-inference-api-vs-dedicated-inference-endpoints">Comparison of Inference API vs Dedicated Inference Endpoints<a class="anchor" aria-label="anchor" href="#comparison-of-inference-api-vs-dedicated-inference-endpoints"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>Inference API</th>
<th>Dedicated Inference Endpoints</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Accessibility</strong></td>
<td>Public, shared service</td>
<td>Private, dedicated hardware</td>
</tr>
<tr class="even">
<td><strong>Cost</strong></td>
<td>Free (with paid tiers)</td>
<td>Paid service - rent specific hardware</td>
</tr>
<tr class="odd">
<td><strong>Hardware</strong></td>
<td>Shared computing resources</td>
<td>Dedicated hardware allocation</td>
</tr>
<tr class="even">
<td><strong>Wait Times</strong></td>
<td>Variable, unknowable in advance</td>
<td>Predictable, minimal queuing, ~30s for first request</td>
</tr>
<tr class="odd">
<td><strong>Production Ready</strong></td>
<td>Not recommended for production</td>
<td>Recommended for production use</td>
</tr>
<tr class="even">
<td><strong>Use Case</strong></td>
<td>Casual usage, testing, prototyping</td>
<td>Production applications, consistent performance</td>
</tr>
<tr class="odd">
<td><strong>Scalability</strong></td>
<td>Limited by shared resources</td>
<td>Scales with dedicated allocation</td>
</tr>
<tr class="even">
<td><strong>Availability</strong></td>
<td>Subject to shared infrastructure limits</td>
<td>Guaranteed availability during rental period</td>
</tr>
<tr class="odd">
<td><strong>Model Coverage</strong></td>
<td>Commonly-used models, models selected by Hugging Face</td>
<td>Virtually all models on the Hub are available</td>
</tr>
</tbody>
</table>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/jpcompartir" class="external-link">Jack Penzer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
