<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Structured Outputs - JSON Schema • EndpointR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Lato-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Merriweather-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Structured Outputs - JSON Schema">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EndpointR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/api_keys.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/api_keys.html">API Key Management</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Hugging Face</h6></li>
    <li><a class="dropdown-item" href="../articles/hugging_face_inference.html">Hugging Face Inference Endpoints</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>LLM Providers (OpenAI, Anthropic)</h6></li>
    <li><a class="dropdown-item" href="../articles/llm_providers.html">Working with Major LLM Providers</a></li>
    <li><a class="dropdown-item" href="../articles/structured_outputs_json_schema.html">Structured Outputs with JSON Schema</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Embeddings</h6></li>
    <li><a class="dropdown-item" href="../articles/embeddings_providers.html">Embeddings Providers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/improving_performance.html">Improving Performance</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jpcompartir/EndpointR" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Structured Outputs - JSON Schema</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jpcompartir/EndpointR/tree/main/vignettes/structured_outputs_json_schema.Rmd" class="external-link"><code>vignettes/structured_outputs_json_schema.Rmd</code></a></small>
      <div class="d-none name"><code>structured_outputs_json_schema.Rmd</code></div>
    </div>

    
    
<blockquote>
<p><strong>NOTE:</strong> This vignette was generated by Claude 4
Sonnet, and then edited by hand. The JSON Schema code was written by
hand and then adapted by the same model. If you think your code was
copied, or used by Sonnet, please let us know and we will credit
accordingly.</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jpcompartir.github.io/EndpointR/">EndpointR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rconsortium.github.io/S7/" class="external-link">S7</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cli.r-lib.org" class="external-link">cli</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite" class="external-link">jsonlite</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction-to-structured-outputs">Introduction to Structured Outputs<a class="anchor" aria-label="anchor" href="#introduction-to-structured-outputs"></a>
</h2>
<p>Structured outputs ensure LLMs return data in exactly the format you
need. Instead of parsing messy text, you get validated JSON matching
your schema.</p>
<p><strong>Why use structured outputs?</strong> - eliminates parsing
errors and inconsistent formats - guarantees data types (numbers vs
strings, booleans vs text) - enables reliable data extraction pipelines
- reduces prompt engineering overhead</p>
<p><strong>Basic workflow:</strong> 1. define schema using helper
functions 2. send requests to OpenAI with schema passed in 3. validate
response with <code><a href="../reference/validate_response.html">validate_response()</a></code></p>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<blockquote>
<p><strong>WARNING:</strong> if using the schema for structured outputs
from OpenAI, all fields <em>MUST</em> be required:</p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_json_schema.html">create_json_schema</a></span><span class="op">(</span></span>
<span> name <span class="op">=</span> <span class="st">"contact_info"</span>,</span>
<span> schema <span class="op">=</span> <span class="fu"><a href="../reference/schema_object.html">schema_object</a></span><span class="op">(</span></span>
<span>   name <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"person's full name"</span><span class="op">)</span>,</span>
<span>   email <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"email address"</span><span class="op">)</span>,</span>
<span>   phone <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"phone number"</span><span class="op">)</span>,</span>
<span>   required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"email"</span>, <span class="st">"phone"</span><span class="op">)</span>,</span>
<span>   additional_properties <span class="op">=</span> <span class="cn">FALSE</span></span>
<span> <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oai_build_completions_request.html">oai_build_completions_request</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="st">"Am I speaking with Margaret Phillips? Yes, ok, and your email is mphil@hotmail.co.uk. Ok perfect, and your phone number? Was that 07564789789? Ok great. Just a second please Margaret, you're verified"</span>,</span>
<span>  schema <span class="op">=</span> <span class="va">contact_schema</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"choices"</span>, <span class="fl">1</span>, <span class="st">"message"</span>, <span class="st">"content"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/validate_response.html">validate_response</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="va">contact_schema</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> The first time you send a request with a
schema, it will take longer than usual. “Typical schemas take under 10
seconds to process on the first request, but more complex schemas may
take up to a minute.” <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://openai.com/index/introducing-structured-outputs-in-the-api/" class="external-link"&gt;OAI
Docs&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a></p>
</blockquote>
</div>
<div class="section level2">
<h2 id="schema-types">Schema Types<a class="anchor" aria-label="anchor" href="#schema-types"></a>
</h2>
<p>EndpointR provides several schema types to match different data
extraction needs. Each type enforces specific constraints and
validations:</p>
<ul>
<li>
<code><a href="../reference/schema_string.html">schema_string()</a></code> - text data</li>
<li>
<code><a href="../reference/schema_number.html">schema_number()</a></code> / <code><a href="../reference/schema_integer.html">schema_integer()</a></code> -
numeric values with optional min/max</li>
<li>
<code><a href="../reference/schema_boolean.html">schema_boolean()</a></code> - true/false values</li>
<li>
<code><a href="../reference/schema_enum.html">schema_enum()</a></code> - predefined choices</li>
<li>
<code><a href="../reference/schema_array.html">schema_array()</a></code> - lists of items</li>
<li>
<code><a href="../reference/schema_object.html">schema_object()</a></code> - nested structures</li>
</ul>
<p>Let’s explore each type with practical examples:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># text classification with enums</span></span>
<span><span class="va">sentiment_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_json_schema.html">create_json_schema</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"sentiment_analysis"</span>,</span>
<span>  schema <span class="op">=</span> <span class="fu"><a href="../reference/schema_object.html">schema_object</a></span><span class="op">(</span></span>
<span>    sentiment <span class="op">=</span> <span class="fu"><a href="../reference/schema_enum.html">schema_enum</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"positive"</span>, <span class="st">"negative"</span>, <span class="st">"neutral"</span><span class="op">)</span>,</span>
<span>      <span class="st">"overall sentiment of text"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    confidence <span class="op">=</span> <span class="fu"><a href="../reference/schema_number.html">schema_number</a></span><span class="op">(</span></span>
<span>      <span class="st">"confidence score"</span>, </span>
<span>      minimum <span class="op">=</span> <span class="fl">0</span>, </span>
<span>      maximum <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    is_spam <span class="op">=</span> <span class="fu"><a href="../reference/schema_boolean.html">schema_boolean</a></span><span class="op">(</span><span class="st">"contains spam content"</span><span class="op">)</span>,</span>
<span>    required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sentiment"</span>, <span class="st">"confidence"</span>, <span class="st">"is_spam"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You can inspect the schema then print it in a human-readable form
with <code><a href="../reference/json_dump.html">json_dump()</a></code> and <code><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">jsonlite::toJSON()</a></code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/json_dump.html">json_dump</a></span><span class="op">(</span><span class="va">sentiment_schema</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Another, more complicated, schema for product review extraction,
where we introduce the <code>schema_array</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rating_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_json_schema.html">create_json_schema</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"product_review"</span>,</span>
<span>  schema <span class="op">=</span> <span class="fu"><a href="../reference/schema_object.html">schema_object</a></span><span class="op">(</span></span>
<span>    rating <span class="op">=</span> <span class="fu"><a href="../reference/schema_integer.html">schema_integer</a></span><span class="op">(</span><span class="st">"star rating"</span>, minimum <span class="op">=</span> <span class="fl">1</span>, maximum <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"review title"</span><span class="op">)</span>,</span>
<span>    pros <span class="op">=</span> <span class="fu"><a href="../reference/schema_array.html">schema_array</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="st">"positive aspects mentioned"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    cons <span class="op">=</span> <span class="fu"><a href="../reference/schema_array.html">schema_array</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="st">"negative aspects mentioned"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    would_recommend <span class="op">=</span> <span class="fu"><a href="../reference/schema_boolean.html">schema_boolean</a></span><span class="op">(</span><span class="st">"recommends product"</span><span class="op">)</span>,</span>
<span>    required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rating"</span>,<span class="st">"title"</span>, <span class="st">"pros"</span>, <span class="st">"cons"</span>, <span class="st">"would_recommend"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="complex-nested-structures">Complex Nested Structures<a class="anchor" aria-label="anchor" href="#complex-nested-structures"></a>
</h2>
<p>Finally we have a fairly complex schema - the supplier is a
schema_object within a schema_object, and line_items sits within a
schema_object, has a schema_array, with its own schema_object, and
multiple schema_* objects.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># invoice parsing with line items</span></span>
<span><span class="va">invoice_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_json_schema.html">create_json_schema</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"invoice_data"</span>,</span>
<span>  schema <span class="op">=</span> <span class="fu"><a href="../reference/schema_object.html">schema_object</a></span><span class="op">(</span></span>
<span>    <span class="co"># header information</span></span>
<span>    invoice_number <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"invoice reference number"</span><span class="op">)</span>,</span>
<span>    issue_date <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"date issued (YYYY-MM-DD format)"</span><span class="op">)</span>,</span>
<span>    due_date <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"payment due date (YYYY-MM-DD format)"</span><span class="op">)</span>,</span>
<span>    <span class="co"># billing details</span></span>
<span>    supplier <span class="op">=</span> <span class="fu"><a href="../reference/schema_object.html">schema_object</a></span><span class="op">(</span></span>
<span>      name <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"supplier company name"</span><span class="op">)</span>,</span>
<span>      address <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"supplier address"</span><span class="op">)</span>,</span>
<span>      vat_number <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"VAT registration number"</span><span class="op">)</span>,</span>
<span>      required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    customer <span class="op">=</span> <span class="fu"><a href="../reference/schema_object.html">schema_object</a></span><span class="op">(</span></span>
<span>      name <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"customer name"</span><span class="op">)</span>,</span>
<span>      address <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"customer address"</span><span class="op">)</span>,</span>
<span>      required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># line items array</span></span>
<span>    line_items <span class="op">=</span> <span class="fu"><a href="../reference/schema_array.html">schema_array</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/schema_object.html">schema_object</a></span><span class="op">(</span></span>
<span>        description <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"item description"</span><span class="op">)</span>,</span>
<span>        quantity <span class="op">=</span> <span class="fu"><a href="../reference/schema_integer.html">schema_integer</a></span><span class="op">(</span><span class="st">"quantity ordered"</span>, minimum <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        unit_price <span class="op">=</span> <span class="fu"><a href="../reference/schema_number.html">schema_number</a></span><span class="op">(</span><span class="st">"price per unit"</span>, minimum <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        line_total <span class="op">=</span> <span class="fu"><a href="../reference/schema_number.html">schema_number</a></span><span class="op">(</span><span class="st">"total for this line"</span>, minimum <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"description"</span>, <span class="st">"quantity"</span>, <span class="st">"unit_price"</span>, <span class="st">"line_total"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="st">"invoice line items"</span>,</span>
<span>      min_items <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># totals</span></span>
<span>    subtotal <span class="op">=</span> <span class="fu"><a href="../reference/schema_number.html">schema_number</a></span><span class="op">(</span><span class="st">"subtotal before tax"</span>, minimum <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    vat_amount <span class="op">=</span> <span class="fu"><a href="../reference/schema_number.html">schema_number</a></span><span class="op">(</span><span class="st">"VAT amount"</span>, minimum <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    total_amount <span class="op">=</span> <span class="fu"><a href="../reference/schema_number.html">schema_number</a></span><span class="op">(</span><span class="st">"final total amount"</span>, minimum <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">invoice_schema</span><span class="op">@</span><span class="va">schema</span><span class="op">$</span><span class="va">required</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">invoice_schema</span><span class="op">@</span><span class="va">schema</span><span class="op">$</span><span class="va">properties</span><span class="op">)</span>  <span class="co"># This helper line ensures ALL properties are marked as required, which is   mandatory for OpenAI's structured outputs. Without this, the API will reject  the schema. Use this pattern when you want all fields to be required rather  than listing them individually.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h2>
<p>Each schema type enforces specific constraints. We have a method for
validating whether specific responses meet the schema’s constraints.</p>
<div class="section level4">
<h4 id="how-validation-works">How Validation Works<a class="anchor" aria-label="anchor" href="#how-validation-works"></a>
</h4>
<p>When using structured outputs with LLM providers:</p>
<ul>
<li>API-side enforcement: The provider ensures generated responses match
your schema</li>
<li>Local validation: - validate_response() double-checks data integrity
locally</li>
</ul>
<p>This dual approach catches both generation errors and data
transmission issues.</p>
<p>Here’s a comprehensive example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">user_profile_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_json_schema.html">create_json_schema</a></span><span class="op">(</span></span>
<span> name <span class="op">=</span> <span class="st">"user_profile"</span>,</span>
<span> schema <span class="op">=</span> <span class="fu"><a href="../reference/schema_object.html">schema_object</a></span><span class="op">(</span></span>
<span>   <span class="co"># string fields</span></span>
<span>   name <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"full name"</span><span class="op">)</span>,</span>
<span>   bio <span class="op">=</span> <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="st">"user biography"</span><span class="op">)</span>,</span>
<span>   </span>
<span>   <span class="co"># numeric fields</span></span>
<span>   age <span class="op">=</span> <span class="fu"><a href="../reference/schema_integer.html">schema_integer</a></span><span class="op">(</span><span class="st">"age in years"</span>, minimum <span class="op">=</span> <span class="fl">13</span>, maximum <span class="op">=</span> <span class="fl">120</span><span class="op">)</span>,</span>
<span>   account_balance <span class="op">=</span> <span class="fu"><a href="../reference/schema_number.html">schema_number</a></span><span class="op">(</span><span class="st">"balance in pounds"</span>, minimum <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>   is_verified <span class="op">=</span> <span class="fu"><a href="../reference/schema_boolean.html">schema_boolean</a></span><span class="op">(</span><span class="st">"account verified status"</span><span class="op">)</span>,</span>
<span>   newsletter_opt_in <span class="op">=</span> <span class="fu"><a href="../reference/schema_boolean.html">schema_boolean</a></span><span class="op">(</span><span class="st">"subscribed to newsletter"</span><span class="op">)</span>,</span>
<span>   subscription_tier <span class="op">=</span> <span class="fu"><a href="../reference/schema_enum.html">schema_enum</a></span><span class="op">(</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"free"</span>, <span class="st">"premium"</span>, <span class="st">"enterprise"</span><span class="op">)</span>,</span>
<span>     <span class="st">"subscription level"</span><span class="op">)</span>,</span>
<span>   priority <span class="op">=</span> <span class="fu"><a href="../reference/schema_enum.html">schema_enum</a></span><span class="op">(</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>     <span class="st">"support priority level"</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"integer"</span></span>
<span>   <span class="op">)</span>,</span>
<span>   interests <span class="op">=</span> <span class="fu"><a href="../reference/schema_array.html">schema_array</a></span><span class="op">(</span></span>
<span>     <span class="fu"><a href="../reference/schema_string.html">schema_string</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>     <span class="st">"user interests"</span>,</span>
<span>     min_items <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     max_items <span class="op">=</span> <span class="fl">10</span></span>
<span>   <span class="op">)</span>,</span>
<span>   </span>
<span>   required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"age"</span>, <span class="st">"is_verified"</span>, <span class="st">"subscription_tier"</span><span class="op">)</span></span>
<span> <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>QUESTION:</strong> what’s wrong with this schema if we want
to use it with the OpenAI API?</p>
</blockquote>
<details><summary>
Click to view answer
</summary><p>Not all properties are set as required fields, meaning we cannot use
this schema for OpenAI’s structured outputs.</p>
</details><p>Now let’s see what happens when we try validate a mocked response
object which conforms to the schema:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid_user</span> <span class="op">&lt;-</span> <span class="st">'{</span></span>
<span><span class="st">  "name": "Alice Smith",</span></span>
<span><span class="st">  "age": 28,</span></span>
<span><span class="st">  "account_balance": 156.75,</span></span>
<span><span class="st">  "is_verified": true,</span></span>
<span><span class="st">  "newsletter_opt_in": false,</span></span>
<span><span class="st">  "subscription_tier": "premium",</span></span>
<span><span class="st">  "priority": 2,</span></span>
<span><span class="st">  "interests": ["data science", "functional programming", "statistics"]</span></span>
<span><span class="st">}'</span></span>
<span></span>
<span><span class="va">validated_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_response.html">validate_response</a></span><span class="op">(</span><span class="va">user_profile_schema</span>, <span class="va">valid_user</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">validated_data</span><span class="op">)</span></span></code></pre></div>
<p>And when we try to validate a mocked response object which does not
conform to the schema:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">invalid_age</span> <span class="op">&lt;-</span> <span class="st">'{</span></span>
<span><span class="st">  "name": "Young User",</span></span>
<span><span class="st">  "age": 10,</span></span>
<span><span class="st">  "is_verified": true,</span></span>
<span><span class="st">  "subscription_tier": "free"</span></span>
<span><span class="st">}'</span></span>
<span></span>
<span><span class="fu"><a href="../reference/validate_response.html">validate_response</a></span><span class="op">(</span><span class="va">user_profile_schema</span>, <span class="va">invalid_age</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-s7-objects">Working with S7 Objects<a class="anchor" aria-label="anchor" href="#working-with-s7-objects"></a>
</h2>
<p>EndpointR uses <a href="https://rconsortium.github.io/S7/" class="external-link">S7</a>
objects for its schema system. This provides better type safety and
validation, but it means some familiar S3 methods won’t work as
expected. Understanding how to work with these objects will help you
debug issues and customise your schemas.</p>
<p>For example, you cannot call:
<code>jsonlite::toJSON(contact_schema)</code>. If you try, you’ll get
this error: <code>Error: No method asJSON S3 class: S7_object</code></p>
<p>Instead, you should use the S7 method <code>json_dump</code> which
has been defined for the json_schema class. This converts the schema
into an R list which is ready to be converted into JSON. I won’t print
the list as-is because it is long and ugly, instead we can check out the
structure:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_json_dump</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/json_dump.html">json_dump</a></span><span class="op">(</span><span class="va">contact_schema</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">contact_json_dump</span><span class="op">)</span></span></code></pre></div>
<p>Alongside <code>json_dump</code> the
<code><a href="../reference/json_schema.html">EndpointR::json_schema</a></code> is given a
<code>validate_response</code> method we saw it used earlier in the
quickstart.</p>
<div class="section level3">
<h3 id="converting-schema-objects-to-json">Converting Schema Objects to JSON<a class="anchor" aria-label="anchor" href="#converting-schema-objects-to-json"></a>
</h3>
<p>You can convert the dumped schema to a JSON object using {jsonlite}‘s
<code>toJSON</code> function. This object will now be of the class
’json’.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_json_schema</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">contact_json_dump</span>, </span>
<span>                 pretty <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">contact_json_schema</span><span class="op">)</span></span></code></pre></div>
<details><summary>
View pretty-printed Schema in JSON form
</summary><div class="sourceCode" id="cb12"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"json_schema"</span><span class="fu">,</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="dt">"json_schema"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"contact_info"</span><span class="fu">,</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="dt">"schema"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"object"</span><span class="fu">,</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>      <span class="dt">"properties"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>        <span class="dt">"name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>          <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"person's full name"</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>        <span class="dt">"email"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>          <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"email address"</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>        <span class="dt">"phone"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>          <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"phone number"</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>      <span class="dt">"additionalProperties"</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>      <span class="dt">"required"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"name"</span><span class="ot">,</span> <span class="st">"email"</span><span class="ot">,</span> <span class="st">"phone"</span><span class="ot">]</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>    <span class="dt">"strict"</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="fu">}</span> </span></code></pre></div>
</details><p>And we can convert our schema back to a regular R list with
{jsonlite}’s <code>fromJSON</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">from_contact_json_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">contact_json_schema</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">from_contact_json_schema</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<p>Schema design principles:</p>
<ul>
<li>Use descriptive field names and descriptions</li>
<li>Set appropriate constraints (min/max values, required fields)</li>
<li>Prefer enums over free text for categories but give the model outs,
or it will hallucinate e.g. an ‘other’ option for when the document
doesn’t have what you’re looking for</li>
<li>Nest objects logically for complex data</li>
<li>Validate some mock responses in advance</li>
</ul>
</div>
<div class="section level2">
<h2 id="troubleshooting-tips">Troubleshooting tips:<a class="anchor" aria-label="anchor" href="#troubleshooting-tips"></a>
</h2>
<ul>
<li>Use json_dump() to inspect final schema structure</li>
<li>use <code>jsonlite::toJSON(x, pretty = TRUE)</code> to view the
schema in a human-readable form</li>
<li>Test schemas with mock data using validate_response()</li>
<li>Start simple and add complexity incrementally</li>
<li>Check enum values match expected model outputs</li>
<li>Validate required fields cover essential data</li>
<li>Make sure all properties are required if using OpenAI API for
structured outputs</li>
</ul>
</div>
<div class="section level2">
<h2 id="types-reference">Types Reference<a class="anchor" aria-label="anchor" href="#types-reference"></a>
</h2>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Type</th>
<th>Use Case</th>
<th>Example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/schema_string.html">schema_string()</a></code></td>
<td>Text, names, descriptions</td>
<td><code>schema_string("email address")</code></td>
</tr>
<tr class="even">
<td><code><a href="../reference/schema_integer.html">schema_integer()</a></code></td>
<td>Whole numbers, counts</td>
<td><code>schema_integer("age", minimum = 0, maximum = 120)</code></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/schema_number.html">schema_number()</a></code></td>
<td>Decimals, prices, scores</td>
<td><code>schema_number("price", minimum = 0)</code></td>
</tr>
<tr class="even">
<td><code><a href="../reference/schema_boolean.html">schema_boolean()</a></code></td>
<td>Yes/no, true/false flags</td>
<td><code>schema_boolean("is_active")</code></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/schema_enum.html">schema_enum()</a></code></td>
<td>Fixed choices</td>
<td><code>schema_enum(c("small", "medium", "large"), "size")</code></td>
</tr>
<tr class="even">
<td><code><a href="../reference/schema_array.html">schema_array()</a></code></td>
<td>Lists, multiple values</td>
<td><code>schema_array(schema_string(), "tags")</code></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/schema_object.html">schema_object()</a></code></td>
<td>Nested structures</td>
<td><code>schema_object(name = schema_string("..."), ...)</code></td>
</tr>
</tbody>
</table>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/jpcompartir" class="external-link">Jack Penzer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
