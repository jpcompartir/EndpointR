<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate embeddings for texts in a data frame using OpenAI — oai_embed_df • EndpointR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate embeddings for texts in a data frame using OpenAI — oai_embed_df"><meta name="description" content="High-level function to generate embeddings for texts in a data frame using
OpenAI's embedding API. This function handles the entire process from request
creation to response processing, with options for batching &amp;amp; concurrent requests."><meta property="og:description" content="High-level function to generate embeddings for texts in a data frame using
OpenAI's embedding API. This function handles the entire process from request
creation to response processing, with options for batching &amp;amp; concurrent requests."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EndpointR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/api_keys.html">API Key Management</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Hugging Face</h6></li>
    <li><a class="dropdown-item" href="../articles/hugging_face_inference.html">Hugging Face Inference Endpoints</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>LLM Providers (OpenAI, Anthropic)</h6></li>
    <li><a class="dropdown-item" href="../articles/llm_providers.html">Working with Major LLM Providers</a></li>
    <li><a class="dropdown-item" href="../articles/structured_outputs_json_schema.html">Structured Outputs with JSON Schema</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Embeddings</h6></li>
    <li><a class="dropdown-item" href="../articles/embeddings_providers.html">Embeddings Providers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/improving_performance.html">Improving Performance</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jpcompartir/EndpointR" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate embeddings for texts in a data frame using OpenAI</h1>
      <small class="dont-index">Source: <a href="https://github.com/jpcompartir/EndpointR/tree/main/R/openai_embed.R" class="external-link"><code>R/openai_embed.R</code></a></small>
      <div class="d-none name"><code>oai_embed_df.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>High-level function to generate embeddings for texts in a data frame using
OpenAI's embedding API. This function handles the entire process from request
creation to response processing, with options for batching &amp; concurrent requests.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">oai_embed_df</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">text_var</span>,</span>
<span>  <span class="va">id_var</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"text-embedding-3-small"</span>,</span>
<span>  dimensions <span class="op">=</span> <span class="fl">1536</span>,</span>
<span>  key_name <span class="op">=</span> <span class="st">"OPENAI_API_KEY"</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  concurrent_requests <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  max_retries <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  timeout <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  endpoint_url <span class="op">=</span> <span class="st">"https://api.openai.com/v1/embeddings"</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>Data frame containing texts to embed</p></dd>


<dt id="arg-text-var">text_var<a class="anchor" aria-label="anchor" href="#arg-text-var"></a></dt>
<dd><p>Column name (unquoted) containing texts to embed</p></dd>


<dt id="arg-id-var">id_var<a class="anchor" aria-label="anchor" href="#arg-id-var"></a></dt>
<dd><p>Column name (unquoted) for unique row identifiers</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>OpenAI embedding model to use (default: "text-embedding-3-small")</p></dd>


<dt id="arg-dimensions">dimensions<a class="anchor" aria-label="anchor" href="#arg-dimensions"></a></dt>
<dd><p>Number of embedding dimensions (NULL uses model default)</p></dd>


<dt id="arg-key-name">key_name<a class="anchor" aria-label="anchor" href="#arg-key-name"></a></dt>
<dd><p>Name of environment variable containing the API key</p></dd>


<dt id="arg-batch-size">batch_size<a class="anchor" aria-label="anchor" href="#arg-batch-size"></a></dt>
<dd><p>Number of texts to process in one batch (default: 10)</p></dd>


<dt id="arg-concurrent-requests">concurrent_requests<a class="anchor" aria-label="anchor" href="#arg-concurrent-requests"></a></dt>
<dd><p>Number of concurrent requests (default: 1)</p></dd>


<dt id="arg-max-retries">max_retries<a class="anchor" aria-label="anchor" href="#arg-max-retries"></a></dt>
<dd><p>Maximum retry attempts per request (default: 5)</p></dd>


<dt id="arg-timeout">timeout<a class="anchor" aria-label="anchor" href="#arg-timeout"></a></dt>
<dd><p>Request timeout in seconds (default: 20)</p></dd>


<dt id="arg-endpoint-url">endpoint_url<a class="anchor" aria-label="anchor" href="#arg-endpoint-url"></a></dt>
<dd><p>OpenAI API endpoint URL</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Whether to display a progress bar (default: TRUE)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Original data frame with additional columns for embeddings (V1, V2, etc.),
plus .error and .error_message columns indicating any failures</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function extracts texts from a specified column, generates embeddings using
<code><a href="oai_embed_batch.html">oai_embed_batch()</a></code>, and joins the results back to the original data frame using
a specified ID column.</p>
<p>The function preserves the original data frame structure and adds new columns
for embedding dimensions (V1, V2, ..., Vn). If the number of rows doesn't match
after processing (due to errors), it returns the results with a warning.</p>
<p>OpenAI's embedding API allows you to specify the number of dimensions for the
output embeddings, which can be useful for reducing memory usage, storage cost,s or matching
specific downstream requirements. The default is model-specific (1536 for
text-embedding-3-small). <a href="https://openai.com/index/new-embedding-models-and-api-updates/" class="external-link">OpenAI Embedding Updates</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>    text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"First example"</span>, <span class="st">"Second example"</span>, <span class="st">"Third example"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Generate embeddings with default dimensions</span></span></span>
<span class="r-in"><span>  <span class="va">embeddings_df</span> <span class="op">&lt;-</span> <span class="fu">oai_embed_df</span><span class="op">(</span></span></span>
<span class="r-in"><span>    df <span class="op">=</span> <span class="va">df</span>,</span></span>
<span class="r-in"><span>    text_var <span class="op">=</span> <span class="va">text</span>,</span></span>
<span class="r-in"><span>    id_var <span class="op">=</span> <span class="va">id</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Generate embeddings with custom dimensions</span></span></span>
<span class="r-in"><span>  <span class="va">embeddings_df</span> <span class="op">&lt;-</span> <span class="fu">oai_embed_df</span><span class="op">(</span></span></span>
<span class="r-in"><span>    df <span class="op">=</span> <span class="va">df</span>,</span></span>
<span class="r-in"><span>    text_var <span class="op">=</span> <span class="va">text</span>,</span></span>
<span class="r-in"><span>    id_var <span class="op">=</span> <span class="va">id</span>,</span></span>
<span class="r-in"><span>    dimensions <span class="op">=</span> <span class="fl">360</span>,  <span class="co"># smaller embeddings</span></span></span>
<span class="r-in"><span>    batch_size <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Use with concurrent requests for faster processing</span></span></span>
<span class="r-in"><span>  <span class="va">embeddings_df</span> <span class="op">&lt;-</span> <span class="fu">oai_embed_df</span><span class="op">(</span></span></span>
<span class="r-in"><span>    df <span class="op">=</span> <span class="va">df</span>,</span></span>
<span class="r-in"><span>    text_var <span class="op">=</span> <span class="va">text</span>,</span></span>
<span class="r-in"><span>    id_var <span class="op">=</span> <span class="va">id</span>,</span></span>
<span class="r-in"><span>    model <span class="op">=</span> <span class="st">"text-embedding-3-large"</span>,</span></span>
<span class="r-in"><span>    concurrent_requests <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/jpcompartir" class="external-link">Jack Penzer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

